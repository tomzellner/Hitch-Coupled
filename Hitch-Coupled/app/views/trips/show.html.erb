<% if current_user == @driver %>
	<h1>Welcome to Your Trip </h1>
	<%= link_to 'edit trip', edit_trip_path %>

	<% if !@trip.started %>
		<h2> Waiting for Trip to start </h2>
		<%= button_to "Start", { action: "start", trip_id: @trip.id },
                                method: :patch, data: { confirm: "Are you sure?" } %>
    <% elsif @trip.ended %>
    	<h2> Trip Ended </h2>

	<% elsif @trip.started %>
		<h2> Trip in Progress </h2>
		<%= button_to "End", { action: "end", trip_id: @trip.id },
                                method: :patch, data: { confirm: "Are you sure?" } %>
	<% end %>
<% else %>
	<h1>Welcome to <%= @driver.first_name %> <%= @driver.last_name %>'s Trip </h1>
	<% if !@trip.started %>
		<h2> Waiting for Trip to Start </h2>
	<% elsif @trip.ended %>
    	<h2> Trip Ended </h2>
	<% elsif @trip.started %>
		<h2> Trip in Progress </h2>
	<% end %>
<% end %>


<div>
	<h4>From: <%= @trip.start_city %>, <%= @trip.start_state %></h4>
	<h4>To: <%= @trip.end_city %>, <%= @trip.end_state %></h4>
	<h4>Start Date: <%= @trip.start_date.to_time.strftime('%B %e 20%y') %></h4>
	<h4>End Date: <%= @trip.end_date.to_time.strftime('%B %e 20%y') %></h4>
	<span> Seats in car: <%= @trip.car.seats %> </span>
</div>
<!-- DRIVERS DIV -->

<%= link_to user_path(@driver) do  %>
	<div style="border: thin solid black" id = 'driver_profile'>
		Driver: <%= @driver.first_name %>
		<%= @driver.last_name %><br>
		

		<% if @trip.ended && !current_user == @driver && @trip.passengers.include?(current_user)%>
			<%= form_for @rating do |f| %>
				<%= f.hidden_field :rater_id, :value => current_user.id %>
				<%= f.hidden_field :rated_id, :value => @driver.id %>
				<%= f.label(:score, 'Score') %>
				<%= f.select(:score, options_for_select(1..5)) %>
				<%= f.submit('Rate') %>
			<% end %>
		<% end %>
	</div>
<% end %>

 <!-- PASSENGERS DVIS -->

<% @trip.passengers.each do |p| %>
	<%= link_to user_path(p) do  %>
		<div style="border: thin solid black" > 
			Passenger: <%= p.first_name %> 
			<%= p.last_name %> 
		<% if @trip.ended && @trip.passengers.include?(current_user) && p.id != current_user.id  %>
			<%= form_for @rating do |f| %>
				<%= f.hidden_field :rater_id, :value => current_user.id %>
				<%= f.hidden_field :rated_id, :value => p.id %>
				<%= f.label(:score, 'Score') %>
				<%= f.select(:score, options_for_select(1..5)) %>
				<%= f.submit('Rate') %>
			<% end %>
		<% end %>
		</div>
	<% end %>
<% end %>


<% if !current_user == @driver && @trip.passengers.length < @trip.num_passengers && !@trip.passengers.include?(current_user)%>
	<%= link_to "add passagger", trip_add_passenger_path(@trip) %>
<% end %>

